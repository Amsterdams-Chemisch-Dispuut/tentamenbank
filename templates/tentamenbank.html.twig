{% if my_courses %}
<h3>Enrolled Courses</h3>
<table id="enrolled" class="table table-hover mb-5" style="width:100%">
    <thead>
        <tr>
            <th>Subject</th>
            <th>Course ID</th>
            <th>Study</th>
        </tr>
    </thead>
    <tbody>
        {% for course in my_courses %}
        <tr onclick="window.location='{{ course.url }}';" style="cursor:pointer;">
            <td>{{ course.subject }}</td>
            <td>{{ course.course_id }}</td>
            <td>{{ course.study }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<h3>All Courses</h3>
<div class="row mb-3 ">
    <div class="col-auto">
        <div class="btn-group" role="group" aria-label="Study Level">
            <button type="button" class="btn btn-outline-primary" onclick="filterTable('Bachelor', this)">Bachelor</button>
            <button type="button" class="btn btn-outline-primary" onclick="filterTable('Master', this)">Master</button>
            <button type="button" class="btn btn-outline-primary" onclick="filterTable('Pre-master', this)">Pre-master</button>
            <button type="button" class="btn btn-outline-primary" onclick="filterTable('Other', this)">Other</button>
        </div>
    </div>
    <div class="col">
        <div class="input-group">
            <input type="text" id="search" placeholder="Search..." class="form-control">
        </div>
    </div>
</div>

<table id="subjects" class="table table-hover" style="width:100%">
    <thead>
        <tr>
            <th>Subject</th>
            <th>Course ID</th>
            <th>Study</th>
        </tr>
    </thead>
    <tbody id="subjects-body">
        {% for subject in subjects %}
        <tr onclick="window.location='{{ subject.url }}';" style="cursor:pointer;">
            <td>{{ subject.subject }}</td>
            <td>
                {% if subject.course_id %}
                    {{ subject.course_id }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ subject.study }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="javascript:void(0)" id="prevPage" onclick="changePage(-1)">Previous</a>
            </li>
            <li class="page-item disabled">
                <span class="page-link" id="pageInfo"></span>
            </li>
            <li class="page-item">
                <a class="page-link" href="javascript:void(0)" id="nextPage" onclick="changePage(1)">Next</a>
            </li>
        </ul>
    </nav>
</div>

<style>
    .btn-check:focus + .btn, .btn:focus { box-shadow: none; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    renderTable();
    document.getElementById('search').addEventListener('keyup', function(e) {
        currentSearch = e.target.value.toLowerCase();
        currentPage = 1; 
        renderTable();
    });
});

let currentStudyFilter = null; 
let currentSearch = '';
let currentPage = 1;
const rowsPerPage = 10; 

function filterTable(studyLevel, btnElement) {
    const isActive = btnElement.classList.contains('btn-primary');
    if (isActive) {
        currentStudyFilter = null;
        btnElement.classList.remove('btn-primary');
        btnElement.classList.add('btn-outline-primary');
    } else {
        currentStudyFilter = studyLevel;
        const group = btnElement.parentElement;
        group.querySelectorAll('.btn').forEach(btn => {
            btn.classList.remove('btn-primary'); 
            btn.classList.remove('active'); 
            btn.classList.add('btn-outline-primary');
        });
        btnElement.classList.remove('btn-outline-primary');
        btnElement.classList.add('btn-primary');
    }
    btnElement.blur();
    currentPage = 1; 
    renderTable();
}

function changePage(direction) {
    const validRows = getFilteredRows();
    const totalPages = Math.ceil(validRows.length / rowsPerPage) || 1;
    const newPage = currentPage + direction;
    if (newPage > 0 && newPage <= totalPages) {
        currentPage = newPage;
        renderTable();
    }
}

function getFilteredRows() {
    const tableBody = document.getElementById('subjects-body');
    const allRows = Array.from(tableBody.querySelectorAll('tr'));
    return allRows.filter(row => {
        const cells = row.getElementsByTagName('td');
        const subjectText  = cells[0].textContent.toLowerCase();
        const courseIdText = cells[1].textContent.toLowerCase();
        const studyText    = cells[2].textContent.toLowerCase();

        let matchesStudy = true;
        if (currentStudyFilter) matchesStudy = studyText.includes(currentStudyFilter.toLowerCase());

        let matchesSearch = true;
        if (currentSearch) matchesSearch = subjectText.includes(currentSearch) || courseIdText.includes(currentSearch);

        return matchesStudy && matchesSearch;
    });
}

function renderTable() {
    const tableBody = document.getElementById('subjects-body');
    const allRows = Array.from(tableBody.querySelectorAll('tr'));
    const validRows = getFilteredRows();
    allRows.forEach(row => row.style.display = 'none');
    
    const totalPages = Math.ceil(validRows.length / rowsPerPage) || 1;
    if (currentPage > totalPages) currentPage = totalPages;
    if (currentPage < 1) currentPage = 1;
    
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = startIndex + rowsPerPage;
    validRows.slice(startIndex, endIndex).forEach(row => row.style.display = '');

    document.getElementById('pageInfo').innerText = `Page ${currentPage} of ${totalPages}`;
    const prevBtn = document.getElementById('prevPage').parentElement;
    const nextBtn = document.getElementById('nextPage').parentElement;
    
    if (currentPage === 1) prevBtn.classList.add('disabled'); else prevBtn.classList.remove('disabled');
    if (currentPage === totalPages) nextBtn.classList.add('disabled'); else nextBtn.classList.remove('disabled');
}
</script>